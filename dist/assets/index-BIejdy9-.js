var Uo=Object.defineProperty;var Ro=(e,t,n)=>t in e?Uo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var $=(e,t,n)=>Ro(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();function kn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Jn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Po(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");kn(e.outputLen),kn(e.blockLen)}function st(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ho(e,t){Jn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const _t=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Yn=e=>e instanceof Uint8Array,Nt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),re=(e,t)=>e<<32-t|e>>>t,Oo=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Oo)throw new Error("Non little-endian hardware is not supported");function Mo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Jt(e){if(typeof e=="string"&&(e=Mo(e)),!Yn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Do(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!Yn(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let Xn=class{clone(){return this._cloneInto()}};function qo(e){const t=r=>e().update(Jt(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Qn(e=32){if(_t&&typeof _t.getRandomValues=="function")return _t.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function zo(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,u=r?0:4;e.setUint32(t+a,i,r),e.setUint32(t+u,c,r)}let jo=class extends Xn{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Nt(this.buffer)}update(t){st(this);const{view:n,buffer:r,blockLen:o}=this;t=Jt(t);const s=t.length;for(let i=0;i<s;){const c=Math.min(o-this.pos,s-i);if(c===o){const a=Nt(t);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){st(this),Ho(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;zo(r,o-8,BigInt(this.length*8),s),this.process(r,0);const c=Nt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)c.setUint32(4*l,f[l],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}};const Fo=(e,t,n)=>e&t^~e&n,Ko=(e,t,n)=>e&t^e&n^t&n,Vo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),we=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),me=new Uint32Array(64);let Wo=class extends jo{constructor(){super(64,32,8,!1),this.A=we[0]|0,this.B=we[1]|0,this.C=we[2]|0,this.D=we[3]|0,this.E=we[4]|0,this.F=we[5]|0,this.G=we[6]|0,this.H=we[7]|0}get(){const{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[t,n,r,o,s,i,c,a]}set(t,n,r,o,s,i,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)me[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const p=me[l-15],w=me[l-2],g=re(p,7)^re(p,18)^p>>>3,d=re(w,17)^re(w,19)^w>>>10;me[l]=d+me[l-7]+g+me[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:u,H:f}=this;for(let l=0;l<64;l++){const p=re(c,6)^re(c,11)^re(c,25),w=f+p+Fo(c,a,u)+Vo[l]+me[l]|0,d=(re(r,2)^re(r,13)^re(r,22))+Ko(r,o,s)|0;f=u,u=a,a=c,c=i+w|0,i=s,s=o,o=r,r=w+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,o,s,i,c,a,u,f)}roundClean(){me.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Ht=qo(()=>new Wo);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const er=BigInt(0),ut=BigInt(1),Zo=BigInt(2),ft=e=>e instanceof Uint8Array,Go=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Oe(e){if(!ft(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Go[e[n]];return t}function tr(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function Yt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Me(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function G(e){return Yt(Oe(e))}function Xt(e){if(!ft(e))throw new Error("Uint8Array expected");return Yt(Oe(Uint8Array.from(e).reverse()))}function Ae(e,t){return Me(e.toString(16).padStart(t*2,"0"))}function Qt(e,t){return Ae(e,t).reverse()}function Jo(e){return Me(tr(e))}function K(e,t,n){let r;if(typeof t=="string")try{r=Me(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(ft(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function ke(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!ft(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function Yo(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Xo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Qo(e){let t;for(t=0;e>er;e>>=ut,t+=1);return t}function es(e,t){return e>>BigInt(t)&ut}const ts=(e,t,n)=>e|(n?ut:er)<<BigInt(t),en=e=>(Zo<<BigInt(e-1))-ut,Bt=e=>new Uint8Array(e),Tn=e=>Uint8Array.from(e);function nr(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Bt(e),o=Bt(e),s=0;const i=()=>{r.fill(1),o.fill(0),s=0},c=(...l)=>n(o,r,...l),a=(l=Bt())=>{o=c(Tn([0]),l),r=c(),l.length!==0&&(o=c(Tn([1]),l),r=c())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const p=[];for(;l<t;){r=c();const w=r.slice();p.push(w),l+=r.length}return ke(...p)};return(l,p)=>{i(),a(l);let w;for(;!(w=p(u()));)a();return i(),w}}const ns={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Xe(e,t,n={}){const r=(o,s,i)=>{const c=ns[s];if(typeof c!="function")throw new Error(`Invalid validator "${s}", expected function`);const a=e[o];if(!(i&&a===void 0)&&!c(a,e))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${s}`)};for(const[o,s]of Object.entries(t))r(o,s,!1);for(const[o,s]of Object.entries(n))r(o,s,!0);return e}const rs=Object.freeze(Object.defineProperty({__proto__:null,bitGet:es,bitLen:Qo,bitMask:en,bitSet:ts,bytesToHex:Oe,bytesToNumberBE:G,bytesToNumberLE:Xt,concatBytes:ke,createHmacDrbg:nr,ensureBytes:K,equalBytes:Yo,hexToBytes:Me,hexToNumber:Yt,numberToBytesBE:Ae,numberToBytesLE:Qt,numberToHexUnpadded:tr,numberToVarBytesBE:Jo,utf8ToBytes:Xo,validateObject:Xe},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const j=BigInt(0),z=BigInt(1),Be=BigInt(2),os=BigInt(3),Ot=BigInt(4),Ln=BigInt(5),$n=BigInt(8);BigInt(9);BigInt(16);function F(e,t){const n=e%t;return n>=j?n:t+n}function ss(e,t,n){if(n<=j||t<j)throw new Error("Expected power/modulo > 0");if(n===z)return j;let r=z;for(;t>j;)t&z&&(r=r*e%n),e=e*e%n,t>>=z;return r}function Y(e,t,n){let r=e;for(;t-- >j;)r*=r,r%=n;return r}function Mt(e,t){if(e===j||t<=j)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=F(e,t),r=t,o=j,s=z;for(;n!==j;){const c=r/n,a=r%n,u=o-s*c;r=n,n=a,o=s,s=u}if(r!==z)throw new Error("invert: does not exist");return F(o,t)}function is(e){const t=(e-z)/Be;let n,r,o;for(n=e-z,r=0;n%Be===j;n/=Be,r++);for(o=Be;o<e&&ss(o,t,e)!==e-z;o++);if(r===1){const i=(e+z)/Ot;return function(a,u){const f=a.pow(u,i);if(!a.eql(a.sqr(f),u))throw new Error("Cannot find square root");return f}}const s=(n+z)/Be;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=r,f=c.pow(c.mul(c.ONE,o),n),l=c.pow(a,s),p=c.pow(a,n);for(;!c.eql(p,c.ONE);){if(c.eql(p,c.ZERO))return c.ZERO;let w=1;for(let d=c.sqr(p);w<u&&!c.eql(d,c.ONE);w++)d=c.sqr(d);const g=c.pow(f,z<<BigInt(u-w-1));f=c.sqr(g),l=c.mul(l,g),p=c.mul(p,f),u=w}return l}}function as(e){if(e%Ot===os){const t=(e+z)/Ot;return function(r,o){const s=r.pow(o,t);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%$n===Ln){const t=(e-Ln)/$n;return function(r,o){const s=r.mul(o,Be),i=r.pow(s,t),c=r.mul(o,i),a=r.mul(r.mul(c,Be),i),u=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(u),o))throw new Error("Cannot find square root");return u}}return is(e)}const cs=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ls(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=cs.reduce((r,o)=>(r[o]="function",r),t);return Xe(e,n)}function us(e,t,n){if(n<j)throw new Error("Expected power > 0");if(n===j)return e.ONE;if(n===z)return t;let r=e.ONE,o=t;for(;n>j;)n&z&&(r=e.mul(r,o)),o=e.sqr(o),n>>=z;return r}function fs(e,t){const n=new Array(t.length),r=t.reduce((s,i,c)=>e.is0(i)?s:(n[c]=s,e.mul(s,i)),e.ONE),o=e.inv(r);return t.reduceRight((s,i,c)=>e.is0(i)?s:(n[c]=e.mul(s,n[c]),e.mul(s,i)),o),n}function rr(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function ds(e,t,n=!1,r={}){if(e<=j)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=rr(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=as(e),c=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:en(o),ZERO:j,ONE:z,create:a=>F(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return j<=a&&a<e},is0:a=>a===j,isOdd:a=>(a&z)===z,neg:a=>F(-a,e),eql:(a,u)=>a===u,sqr:a=>F(a*a,e),add:(a,u)=>F(a+u,e),sub:(a,u)=>F(a-u,e),mul:(a,u)=>F(a*u,e),pow:(a,u)=>us(c,a,u),div:(a,u)=>F(a*Mt(u,e),e),sqrN:a=>a*a,addN:(a,u)=>a+u,subN:(a,u)=>a-u,mulN:(a,u)=>a*u,inv:a=>Mt(a,e),sqrt:r.sqrt||(a=>i(c,a)),invertBatch:a=>fs(c,a),cmov:(a,u,f)=>f?u:a,toBytes:a=>n?Qt(a,s):Ae(a,s),fromBytes:a=>{if(a.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${a.length}`);return n?Xt(a):G(a)}});return Object.freeze(c)}function or(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function sr(e){const t=or(e);return t+Math.ceil(t/2)}function hs(e,t,n=!1){const r=e.length,o=or(t),s=sr(t);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const i=n?G(e):Xt(e),c=F(i,t-z)+z;return n?Qt(c,o):Ae(c,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ps=BigInt(0),It=BigInt(1);function gs(e,t){const n=(o,s)=>{const i=s.negate();return o?i:s},r=o=>{const s=Math.ceil(t/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=e.ZERO,c=o;for(;s>ps;)s&It&&(i=i.add(c)),c=c.double(),s>>=It;return i},precomputeWindow(o,s){const{windows:i,windowSize:c}=r(s),a=[];let u=o,f=u;for(let l=0;l<i;l++){f=u,a.push(f);for(let p=1;p<c;p++)f=f.add(u),a.push(f);u=f.double()}return a},wNAF(o,s,i){const{windows:c,windowSize:a}=r(o);let u=e.ZERO,f=e.BASE;const l=BigInt(2**o-1),p=2**o,w=BigInt(o);for(let g=0;g<c;g++){const d=g*a;let h=Number(i&l);i>>=w,h>a&&(h-=p,i+=It);const y=d,C=d+Math.abs(h)-1,m=g%2!==0,A=h<0;h===0?f=f.add(n(m,s[y])):u=u.add(n(A,s[C]))}return{p:u,f}},wNAFCached(o,s,i,c){const a=o._WINDOW_SIZE||1;let u=s.get(o);return u||(u=this.precomputeWindow(o,a),a!==1&&s.set(o,c(u))),this.wNAF(a,u,i)}}}function ir(e){return ls(e.Fp),Xe(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...rr(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ys(e){const t=ir(e);Xe(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:ws,hexToBytes:ms}=rs,Ie={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=Ie;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:ws(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=Ie,n=typeof e=="string"?ms(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:s}=Ie._parseInt(n.subarray(2)),{d:i,l:c}=Ie._parseInt(s);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(e){const t=u=>Number.parseInt(u[0],16)&8?"00"+u:u,n=u=>{const f=u.toString(16);return f.length&1?`0${f}`:f},r=t(n(e.s)),o=t(n(e.r)),s=r.length/2,i=o.length/2,c=n(s),a=n(i);return`30${n(i+s+4)}02${a}${o}02${c}${r}`}},ce=BigInt(0),X=BigInt(1);BigInt(2);const Un=BigInt(3);BigInt(4);function bs(e){const t=ys(e),{Fp:n}=t,r=t.toBytes||((g,d,h)=>{const y=d.toAffine();return ke(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),o=t.fromBytes||(g=>{const d=g.subarray(1),h=n.fromBytes(d.subarray(0,n.BYTES)),y=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:h,y}});function s(g){const{a:d,b:h}=t,y=n.sqr(g),C=n.mul(y,g);return n.add(n.add(C,n.mul(g,d)),h)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function i(g){return typeof g=="bigint"&&ce<g&&g<t.n}function c(g){if(!i(g))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(g){const{allowedPrivateKeyLengths:d,nByteLength:h,wrapPrivateKey:y,n:C}=t;if(d&&typeof g!="bigint"){if(g instanceof Uint8Array&&(g=Oe(g)),typeof g!="string"||!d.includes(g.length))throw new Error("Invalid key");g=g.padStart(h*2,"0")}let m;try{m=typeof g=="bigint"?g:G(K("private key",g,h))}catch{throw new Error(`private key must be ${h} bytes, hex or bigint, not ${typeof g}`)}return y&&(m=F(m,C)),c(m),m}const u=new Map;function f(g){if(!(g instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(d,h,y){if(this.px=d,this.py=h,this.pz=y,d==null||!n.isValid(d))throw new Error("x required");if(h==null||!n.isValid(h))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(d){const{x:h,y}=d||{};if(!d||!n.isValid(h)||!n.isValid(y))throw new Error("invalid affine point");if(d instanceof l)throw new Error("projective point not allowed");const C=m=>n.eql(m,n.ZERO);return C(h)&&C(y)?l.ZERO:new l(h,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const h=n.invertBatch(d.map(y=>y.pz));return d.map((y,C)=>y.toAffine(h[C])).map(l.fromAffine)}static fromHex(d){const h=l.fromAffine(o(K("pointHex",d)));return h.assertValidity(),h}static fromPrivateKey(d){return l.BASE.multiply(a(d))}_setWindowSize(d){this._WINDOW_SIZE=d,u.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:h}=this.toAffine();if(!n.isValid(d)||!n.isValid(h))throw new Error("bad point: x or y not FE");const y=n.sqr(h),C=s(d);if(!n.eql(y,C))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){f(d);const{px:h,py:y,pz:C}=this,{px:m,py:A,pz:_}=d,E=n.eql(n.mul(h,_),n.mul(m,C)),x=n.eql(n.mul(y,_),n.mul(A,C));return E&&x}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:d,b:h}=t,y=n.mul(h,Un),{px:C,py:m,pz:A}=this;let _=n.ZERO,E=n.ZERO,x=n.ZERO,v=n.mul(C,C),L=n.mul(m,m),I=n.mul(A,A),B=n.mul(C,m);return B=n.add(B,B),x=n.mul(C,A),x=n.add(x,x),_=n.mul(d,x),E=n.mul(y,I),E=n.add(_,E),_=n.sub(L,E),E=n.add(L,E),E=n.mul(_,E),_=n.mul(B,_),x=n.mul(y,x),I=n.mul(d,I),B=n.sub(v,I),B=n.mul(d,B),B=n.add(B,x),x=n.add(v,v),v=n.add(x,v),v=n.add(v,I),v=n.mul(v,B),E=n.add(E,v),I=n.mul(m,A),I=n.add(I,I),v=n.mul(I,B),_=n.sub(_,v),x=n.mul(I,L),x=n.add(x,x),x=n.add(x,x),new l(_,E,x)}add(d){f(d);const{px:h,py:y,pz:C}=this,{px:m,py:A,pz:_}=d;let E=n.ZERO,x=n.ZERO,v=n.ZERO;const L=t.a,I=n.mul(t.b,Un);let B=n.mul(h,m),U=n.mul(y,A),R=n.mul(C,_),D=n.add(h,y),b=n.add(m,A);D=n.mul(D,b),b=n.add(B,U),D=n.sub(D,b),b=n.add(h,C);let S=n.add(m,_);return b=n.mul(b,S),S=n.add(B,R),b=n.sub(b,S),S=n.add(y,C),E=n.add(A,_),S=n.mul(S,E),E=n.add(U,R),S=n.sub(S,E),v=n.mul(L,b),E=n.mul(I,R),v=n.add(E,v),E=n.sub(U,v),v=n.add(U,v),x=n.mul(E,v),U=n.add(B,B),U=n.add(U,B),R=n.mul(L,R),b=n.mul(I,b),U=n.add(U,R),R=n.sub(B,R),R=n.mul(L,R),b=n.add(b,R),B=n.mul(U,b),x=n.add(x,B),B=n.mul(S,b),E=n.mul(D,E),E=n.sub(E,B),B=n.mul(D,U),v=n.mul(S,v),v=n.add(v,B),new l(E,x,v)}subtract(d){return this.add(d.negate())}is0(){return this.equals(l.ZERO)}wNAF(d){return w.wNAFCached(this,u,d,h=>{const y=n.invertBatch(h.map(C=>C.pz));return h.map((C,m)=>C.toAffine(y[m])).map(l.fromAffine)})}multiplyUnsafe(d){const h=l.ZERO;if(d===ce)return h;if(c(d),d===X)return this;const{endo:y}=t;if(!y)return w.unsafeLadder(this,d);let{k1neg:C,k1:m,k2neg:A,k2:_}=y.splitScalar(d),E=h,x=h,v=this;for(;m>ce||_>ce;)m&X&&(E=E.add(v)),_&X&&(x=x.add(v)),v=v.double(),m>>=X,_>>=X;return C&&(E=E.negate()),A&&(x=x.negate()),x=new l(n.mul(x.px,y.beta),x.py,x.pz),E.add(x)}multiply(d){c(d);let h=d,y,C;const{endo:m}=t;if(m){const{k1neg:A,k1:_,k2neg:E,k2:x}=m.splitScalar(h);let{p:v,f:L}=this.wNAF(_),{p:I,f:B}=this.wNAF(x);v=w.constTimeNegate(A,v),I=w.constTimeNegate(E,I),I=new l(n.mul(I.px,m.beta),I.py,I.pz),y=v.add(I),C=L.add(B)}else{const{p:A,f:_}=this.wNAF(h);y=A,C=_}return l.normalizeZ([y,C])[0]}multiplyAndAddUnsafe(d,h,y){const C=l.BASE,m=(_,E)=>E===ce||E===X||!_.equals(C)?_.multiplyUnsafe(E):_.multiply(E),A=m(this,h).add(m(d,y));return A.is0()?void 0:A}toAffine(d){const{px:h,py:y,pz:C}=this,m=this.is0();d==null&&(d=m?n.ONE:n.inv(C));const A=n.mul(h,d),_=n.mul(y,d),E=n.mul(C,d);if(m)return{x:n.ZERO,y:n.ZERO};if(!n.eql(E,n.ONE))throw new Error("invZ was invalid");return{x:A,y:_}}isTorsionFree(){const{h:d,isTorsionFree:h}=t;if(d===X)return!0;if(h)return h(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:h}=t;return d===X?this:h?h(l,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return this.assertValidity(),r(l,this,d)}toHex(d=!0){return Oe(this.toRawBytes(d))}}l.BASE=new l(t.Gx,t.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const p=t.nBitLength,w=gs(l,t.endo?Math.ceil(p/2):p);return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:i}}function Es(e){const t=ir(e);return Xe(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function vs(e){const t=Es(e),{Fp:n,n:r}=t,o=n.BYTES+1,s=2*n.BYTES+1;function i(b){return ce<b&&b<n.ORDER}function c(b){return F(b,r)}function a(b){return Mt(b,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:f,weierstrassEquation:l,isWithinCurveOrder:p}=bs({...t,toBytes(b,S,N){const T=S.toAffine(),k=n.toBytes(T.x),P=ke;return N?P(Uint8Array.from([S.hasEvenY()?2:3]),k):P(Uint8Array.from([4]),k,n.toBytes(T.y))},fromBytes(b){const S=b.length,N=b[0],T=b.subarray(1);if(S===o&&(N===2||N===3)){const k=G(T);if(!i(k))throw new Error("Point is not on curve");const P=l(k);let M=n.sqrt(P);const O=(M&X)===X;return(N&1)===1!==O&&(M=n.neg(M)),{x:k,y:M}}else if(S===s&&N===4){const k=n.fromBytes(T.subarray(0,n.BYTES)),P=n.fromBytes(T.subarray(n.BYTES,2*n.BYTES));return{x:k,y:P}}else throw new Error(`Point of length ${S} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),w=b=>Oe(Ae(b,t.nByteLength));function g(b){const S=r>>X;return b>S}function d(b){return g(b)?c(-b):b}const h=(b,S,N)=>G(b.slice(S,N));class y{constructor(S,N,T){this.r=S,this.s=N,this.recovery=T,this.assertValidity()}static fromCompact(S){const N=t.nByteLength;return S=K("compactSignature",S,N*2),new y(h(S,0,N),h(S,N,2*N))}static fromDER(S){const{r:N,s:T}=Ie.toSig(K("DER",S));return new y(N,T)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(S){return new y(this.r,this.s,S)}recoverPublicKey(S){const{r:N,s:T,recovery:k}=this,P=x(K("msgHash",S));if(k==null||![0,1,2,3].includes(k))throw new Error("recovery id invalid");const M=k===2||k===3?N+t.n:N;if(M>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const O=k&1?"03":"02",Q=u.fromHex(O+w(M)),ge=a(M),Le=c(-P*ge),Ve=c(T*ge),ye=u.BASE.multiplyAndAddUnsafe(Q,Le,Ve);if(!ye)throw new Error("point at infinify");return ye.assertValidity(),ye}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Me(this.toDERHex())}toDERHex(){return Ie.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Me(this.toCompactHex())}toCompactHex(){return w(this.r)+w(this.s)}}const C={isValidPrivateKey(b){try{return f(b),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const b=sr(t.n);return hs(t.randomBytes(b),t.n)},precompute(b=8,S=u.BASE){return S._setWindowSize(b),S.multiply(BigInt(3)),S}};function m(b,S=!0){return u.fromPrivateKey(b).toRawBytes(S)}function A(b){const S=b instanceof Uint8Array,N=typeof b=="string",T=(S||N)&&b.length;return S?T===o||T===s:N?T===2*o||T===2*s:b instanceof u}function _(b,S,N=!0){if(A(b))throw new Error("first arg must be private key");if(!A(S))throw new Error("second arg must be public key");return u.fromHex(S).multiply(f(b)).toRawBytes(N)}const E=t.bits2int||function(b){const S=G(b),N=b.length*8-t.nBitLength;return N>0?S>>BigInt(N):S},x=t.bits2int_modN||function(b){return c(E(b))},v=en(t.nBitLength);function L(b){if(typeof b!="bigint")throw new Error("bigint expected");if(!(ce<=b&&b<v))throw new Error(`bigint expected < 2^${t.nBitLength}`);return Ae(b,t.nByteLength)}function I(b,S,N=B){if(["recovered","canonical"].some(_e=>_e in N))throw new Error("sign() legacy options not supported");const{hash:T,randomBytes:k}=t;let{lowS:P,prehash:M,extraEntropy:O}=N;P==null&&(P=!0),b=K("msgHash",b),M&&(b=K("prehashed msgHash",T(b)));const Q=x(b),ge=f(S),Le=[L(ge),L(Q)];if(O!=null){const _e=O===!0?k(n.BYTES):O;Le.push(K("extraEntropy",_e))}const Ve=ke(...Le),ye=Q;function Ct(_e){const $e=E(_e);if(!p($e))return;const Nn=a($e),Ue=u.BASE.multiply($e).toAffine(),ee=c(Ue.x);if(ee===ce)return;const Re=c(Nn*c(ye+ee*ge));if(Re===ce)return;let Bn=(Ue.x===ee?0:2)|Number(Ue.y&X),In=Re;return P&&g(Re)&&(In=d(Re),Bn^=1),new y(ee,In,Bn)}return{seed:Ve,k2sig:Ct}}const B={lowS:t.lowS,prehash:!1},U={lowS:t.lowS,prehash:!1};function R(b,S,N=B){const{seed:T,k2sig:k}=I(b,S,N),P=t;return nr(P.hash.outputLen,P.nByteLength,P.hmac)(T,k)}u.BASE._setWindowSize(8);function D(b,S,N,T=U){var Ue;const k=b;if(S=K("msgHash",S),N=K("publicKey",N),"strict"in T)throw new Error("options.strict was renamed to lowS");const{lowS:P,prehash:M}=T;let O,Q;try{if(typeof k=="string"||k instanceof Uint8Array)try{O=y.fromDER(k)}catch(ee){if(!(ee instanceof Ie.Err))throw ee;O=y.fromCompact(k)}else if(typeof k=="object"&&typeof k.r=="bigint"&&typeof k.s=="bigint"){const{r:ee,s:Re}=k;O=new y(ee,Re)}else throw new Error("PARSE");Q=u.fromHex(N)}catch(ee){if(ee.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(P&&O.hasHighS())return!1;M&&(S=t.hash(S));const{r:ge,s:Le}=O,Ve=x(S),ye=a(Le),Ct=c(Ve*ye),_e=c(ge*ye),$e=(Ue=u.BASE.multiplyAndAddUnsafe(Q,Ct,_e))==null?void 0:Ue.toAffine();return $e?c($e.x)===ge:!1}return{CURVE:t,getPublicKey:m,getSharedSecret:_,sign:R,verify:D,ProjectivePoint:u,Signature:y,utils:C}}let ar=class extends Xn{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Po(t);const r=Jt(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return st(this),this.iHash.update(t),this}digestInto(t){st(this),Jn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const cr=(e,t,n)=>new ar(e,t).update(n).digest();cr.create=(e,t)=>new ar(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xs(e){return{hash:e,hmac:(t,...n)=>cr(e,t,Do(...n)),randomBytes:Qn}}function As(e,t){const n=r=>vs({...e,...xs(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dt=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),it=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),lr=BigInt(1),at=BigInt(2),Rn=(e,t)=>(e+t/at)/t;function ur(e){const t=dt,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),u=e*e*e%t,f=u*u*e%t,l=Y(f,n,t)*f%t,p=Y(l,n,t)*f%t,w=Y(p,at,t)*u%t,g=Y(w,o,t)*w%t,d=Y(g,s,t)*g%t,h=Y(d,c,t)*d%t,y=Y(h,a,t)*h%t,C=Y(y,c,t)*d%t,m=Y(C,n,t)*f%t,A=Y(m,i,t)*g%t,_=Y(A,r,t)*u%t,E=Y(_,at,t);if(!Dt.eql(Dt.sqr(E),e))throw new Error("Cannot find square root");return E}const Dt=ds(dt,void 0,void 0,{sqrt:ur}),je=As({a:BigInt(0),b:BigInt(7),Fp:Dt,n:it,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=it,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-lr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),c=Rn(s*e,t),a=Rn(-r*e,t);let u=F(e-c*n-a*o,t),f=F(-c*r-a*s,t);const l=u>i,p=f>i;if(l&&(u=t-u),p&&(f=t-f),u>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:u,k2neg:p,k2:f}}}},Ht),ht=BigInt(0),fr=e=>typeof e=="bigint"&&ht<e&&e<dt,Ss=e=>typeof e=="bigint"&&ht<e&&e<it,Pn={};function ct(e,...t){let n=Pn[e];if(n===void 0){const r=Ht(Uint8Array.from(e,o=>o.charCodeAt(0)));n=ke(r,r),Pn[e]=n}return Ht(ke(n,...t))}const tn=e=>e.toRawBytes(!0).slice(1),qt=e=>Ae(e,32),kt=e=>F(e,dt),Ge=e=>F(e,it),nn=je.ProjectivePoint,Cs=(e,t,n)=>nn.BASE.multiplyAndAddUnsafe(e,t,n);function zt(e){let t=je.utils.normPrivateKeyToScalar(e),n=nn.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Ge(-t),bytes:tn(n)}}function dr(e){if(!fr(e))throw new Error("bad x: need 0 < x < p");const t=kt(e*e),n=kt(t*e+BigInt(7));let r=ur(n);r%at!==ht&&(r=kt(-r));const o=new nn(e,r,lr);return o.assertValidity(),o}function hr(...e){return Ge(G(ct("BIP0340/challenge",...e)))}function _s(e){return zt(e).bytes}function Ns(e,t,n=Qn(32)){const r=K("message",e),{bytes:o,scalar:s}=zt(t),i=K("auxRand",n,32),c=qt(s^G(ct("BIP0340/aux",i))),a=ct("BIP0340/nonce",c,o,r),u=Ge(G(a));if(u===ht)throw new Error("sign failed: k is zero");const{bytes:f,scalar:l}=zt(u),p=hr(f,o,r),w=new Uint8Array(64);if(w.set(f,0),w.set(qt(Ge(l+p*s)),32),!pr(w,r,o))throw new Error("sign: Invalid signature produced");return w}function pr(e,t,n){const r=K("signature",e,64),o=K("message",t),s=K("publicKey",n,32);try{const i=dr(G(s)),c=G(r.subarray(0,32));if(!fr(c))return!1;const a=G(r.subarray(32,64));if(!Ss(a))return!1;const u=hr(qt(c),tn(i),o),f=Cs(i,a,Ge(-u));return!(!f||!f.hasEvenY()||f.toAffine().x!==c)}catch{return!1}}const We={getPublicKey:_s,sign:Ns,verify:pr,utils:{randomPrivateKey:je.utils.randomPrivateKey,lift_x:dr,pointToBytes:tn,numberToBytesBE:Ae,bytesToNumberBE:G,taggedHash:ct,mod:F}},Tt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const rn=e=>e instanceof Uint8Array,Lt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),oe=(e,t)=>e<<32-t|e>>>t,Bs=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Bs)throw new Error("Non little-endian hardware is not supported");const Is=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Z(e){if(!rn(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Is[e[n]];return t}function De(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function ks(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Je(e){if(typeof e=="string"&&(e=ks(e)),!rn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function pt(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!rn(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}class gr{clone(){return this._cloneInto()}}function yr(e){const t=r=>e().update(Je(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function wr(e=32){if(Tt&&typeof Tt.getRandomValues=="function")return Tt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function jt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Ts(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function mr(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Ls(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");jt(e.outputLen),jt(e.blockLen)}function $s(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Us(e,t){mr(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const se={number:jt,bool:Ts,bytes:mr,hash:Ls,exists:$s,output:Us};function Rs(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,u=r?0:4;e.setUint32(t+a,i,r),e.setUint32(t+u,c,r)}class Ps extends gr{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Lt(this.buffer)}update(t){se.exists(this);const{view:n,buffer:r,blockLen:o}=this;t=Je(t);const s=t.length;for(let i=0;i<s;){const c=Math.min(o-this.pos,s-i);if(c===o){const a=Lt(t);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){se.exists(this),se.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;Rs(r,o-8,BigInt(this.length*8),s),this.process(r,0);const c=Lt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)c.setUint32(4*l,f[l],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}}const Hs=(e,t,n)=>e&t^~e&n,Os=(e,t,n)=>e&t^e&n^t&n,Ms=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),be=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ee=new Uint32Array(64);class br extends Ps{constructor(){super(64,32,8,!1),this.A=be[0]|0,this.B=be[1]|0,this.C=be[2]|0,this.D=be[3]|0,this.E=be[4]|0,this.F=be[5]|0,this.G=be[6]|0,this.H=be[7]|0}get(){const{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[t,n,r,o,s,i,c,a]}set(t,n,r,o,s,i,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)Ee[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const p=Ee[l-15],w=Ee[l-2],g=oe(p,7)^oe(p,18)^p>>>3,d=oe(w,17)^oe(w,19)^w>>>10;Ee[l]=d+Ee[l-7]+g+Ee[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:u,H:f}=this;for(let l=0;l<64;l++){const p=oe(c,6)^oe(c,11)^oe(c,25),w=f+p+Hs(c,a,u)+Ms[l]+Ee[l]|0,d=(oe(r,2)^oe(r,13)^oe(r,22))+Os(r,o,s)|0;f=u,u=a,a=c,c=i+w|0,i=s,s=o,o=r,r=w+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,o,s,i,c,a,u,f)}roundClean(){Ee.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Ds extends br{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Fe=yr(()=>new br);yr(()=>new Ds);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ke(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function de(...e){const t=(o,s)=>i=>o(s(i)),n=Array.from(e).reverse().reduce((o,s)=>o?t(o,s.encode):s.encode,void 0),r=e.reduce((o,s)=>o?t(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function he(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(Ke(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function pe(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function gt(e,t="="){if(Ke(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Er(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Hn(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const o=[],s=Array.from(e);for(s.forEach(i=>{if(Ke(i),i<0||i>=t)throw new Error(`Wrong integer: ${i}`)});;){let i=0,c=!0;for(let a=r;a<s.length;a++){const u=s[a],f=t*i+u;if(!Number.isSafeInteger(f)||t*i/t!==i||f-u!==t*i)throw new Error("convertRadix: carry overflow");if(i=f%n,s[a]=Math.floor(f/n),!Number.isSafeInteger(s[a])||s[a]*n+i!==f)throw new Error("convertRadix: carry overflow");if(c)s[a]?c=!1:r=a;else continue}if(o.push(i),c)break}for(let i=0;i<e.length-1&&e[i]===0;i++)o.push(0);return o.reverse()}const vr=(e,t)=>t?vr(t,e%t):e,lt=(e,t)=>e+(t-vr(e,t));function Ft(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(lt(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${lt(t,n)}`);let o=0,s=0;const i=2**n-1,c=[];for(const a of e){if(Ke(a),a>=2**t)throw new Error(`convertRadix2: invalid data word=${a} from=${t}`);if(o=o<<t|a,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)c.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=t)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&c.push(o>>>0),c}function qs(e){return Ke(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Hn(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Hn(t,e,2**8))}}}function Se(e,t=!1){if(Ke(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(lt(8,e)>32||lt(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Ft(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Ft(n,e,8,t))}}}function On(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const zs=de(Se(4),he("0123456789ABCDEF"),pe("")),js=de(Se(5),he("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),gt(5),pe(""));de(Se(5),he("0123456789ABCDEFGHIJKLMNOPQRSTUV"),gt(5),pe(""));de(Se(5),he("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),pe(""),Er(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const fe=de(Se(6),he("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),gt(6),pe("")),Fs=de(Se(6),he("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),gt(6),pe("")),on=e=>de(qs(58),he(e),pe("")),Kt=on("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");on("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");on("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Mn=[0,2,3,5,6,7,9,10,11],Ks={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=Kt.encode(r).padStart(Mn[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),o=Mn.indexOf(r.length),s=Kt.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(t)}},Vt=de(he("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),pe("")),Dn=[996825010,642813549,513874426,1027748829,705979059];function Ze(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Dn.length;r++)(t>>r&1)===1&&(n^=Dn[r]);return n}function qn(e,t,n=1){const r=e.length;let o=1;for(let s=0;s<r;s++){const i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=Ze(o)^i>>5}o=Ze(o);for(let s=0;s<r;s++)o=Ze(o)^e.charCodeAt(s)&31;for(let s of t)o=Ze(o)^s;for(let s=0;s<6;s++)o=Ze(o);return o^=n,Vt.encode(Ft([o%2**30],30,5,!1))}function xr(e){const t=e==="bech32"?1:734539939,n=Se(5),r=n.decode,o=n.encode,s=On(r);function i(f,l,p=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof l}`);const w=f.length+7+l.length;if(p!==!1&&w>p)throw new TypeError(`Length ${w} exceeds limit ${p}`);return f=f.toLowerCase(),`${f}1${Vt.encode(l)}${qn(f,l,t)}`}function c(f,l=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||l!==!1&&f.length>l)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${l})`);const p=f.toLowerCase();if(f!==p&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=p;const w=f.lastIndexOf("1");if(w===0||w===-1)throw new Error('Letter "1" must be present between prefix and data only');const g=f.slice(0,w),d=f.slice(w+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");const h=Vt.decode(d).slice(0,-6),y=qn(g,h,t);if(!d.endsWith(y))throw new Error(`Invalid checksum in ${f}: expected "${y}"`);return{prefix:g,words:h}}const a=On(c);function u(f){const{prefix:l,words:p}=c(f,!1);return{prefix:l,words:p,bytes:r(p)}}return{encode:i,decode:c,decodeToBytes:u,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:s,toWords:o}}const qe=xr("bech32");xr("bech32m");const Vs={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},Ws=de(Se(4),he("0123456789abcdef"),pe(""),Er(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),Zs={utf8:Vs,hex:Ws,base16:zs,base32:js,base64:fe,base64url:Fs,base58:Kt,base58xmr:Ks};`${Object.keys(Zs).join(", ")}`;function $t(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function zn(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Gs(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function le(e,...t){if(!Gs(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const W=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Js=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Js)throw new Error("Non little-endian hardware is not supported");function Ys(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Xs(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const Qs=(e,t)=>(Object.assign(t,e),t),xe=16,ei=283;function sn(e){return e<<1^ei&-(e>>7)}function He(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=sn(e);return n}const Wt=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=sn(r))e[n]=r;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return t})(),ti=Wt.map((e,t)=>Wt.indexOf(t)),ni=e=>e<<24|e>>>8,Ut=e=>e<<8|e>>>24;function Ar(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((u,f)=>t(e[f])),r=n.map(Ut),o=r.map(Ut),s=o.map(Ut),i=new Uint32Array(256*256),c=new Uint32Array(256*256),a=new Uint16Array(256*256);for(let u=0;u<256;u++)for(let f=0;f<256;f++){const l=u*256+f;i[l]=n[u]^r[f],c[l]=o[u]^s[f],a[l]=e[u]<<8|e[f]}return{sbox:e,sbox2:a,T0:n,T1:r,T2:o,T3:s,T01:i,T23:c}}const an=Ar(Wt,e=>He(e,3)<<24|e<<16|e<<8|He(e,2)),Sr=Ar(ti,e=>He(e,11)<<24|He(e,13)<<16|He(e,9)<<8|He(e,14)),ri=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=sn(n))e[t]=n;return e})();function Cr(e){le(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=an,r=W(e),o=r.length,s=c=>ie(n,c,c,c,c),i=new Uint32Array(t+28);i.set(r);for(let c=o;c<i.length;c++){let a=i[c-1];c%o===0?a=s(ni(a))^ri[c/o-1]:o>6&&c%o===4&&(a=s(a)),i[c]=i[c-o]^a}return i}function oi(e){const t=Cr(e),n=t.slice(),r=t.length,{sbox2:o}=an,{T0:s,T1:i,T2:c,T3:a}=Sr;for(let u=0;u<r;u+=4)for(let f=0;f<4;f++)n[u+f]=t[r-u-4+f];t.fill(0);for(let u=4;u<r-4;u++){const f=n[u],l=ie(o,f,f,f,f);n[u]=s[l&255]^i[l>>>8&255]^c[l>>>16&255]^a[l>>>24]}return n}function ve(e,t,n,r,o,s){return e[n<<8&65280|r>>>8&255]^t[o>>>8&65280|s>>>24&255]}function ie(e,t,n,r,o){return e[t&255|n&65280]|e[r>>>16&255|o>>>16&65280]<<16}function jn(e,t,n,r,o){const{sbox2:s,T01:i,T23:c}=an;let a=0;t^=e[a++],n^=e[a++],r^=e[a++],o^=e[a++];const u=e.length/4-2;for(let g=0;g<u;g++){const d=e[a++]^ve(i,c,t,n,r,o),h=e[a++]^ve(i,c,n,r,o,t),y=e[a++]^ve(i,c,r,o,t,n),C=e[a++]^ve(i,c,o,t,n,r);t=d,n=h,r=y,o=C}const f=e[a++]^ie(s,t,n,r,o),l=e[a++]^ie(s,n,r,o,t),p=e[a++]^ie(s,r,o,t,n),w=e[a++]^ie(s,o,t,n,r);return{s0:f,s1:l,s2:p,s3:w}}function si(e,t,n,r,o){const{sbox2:s,T01:i,T23:c}=Sr;let a=0;t^=e[a++],n^=e[a++],r^=e[a++],o^=e[a++];const u=e.length/4-2;for(let g=0;g<u;g++){const d=e[a++]^ve(i,c,t,o,r,n),h=e[a++]^ve(i,c,n,t,o,r),y=e[a++]^ve(i,c,r,n,t,o),C=e[a++]^ve(i,c,o,r,n,t);t=d,n=h,r=y,o=C}const f=e[a++]^ie(s,t,o,r,n),l=e[a++]^ie(s,n,t,o,r),p=e[a++]^ie(s,r,n,t,o),w=e[a++]^ie(s,o,r,n,t);return{s0:f,s1:l,s2:p,s3:w}}function _r(e,t){if(!t)return new Uint8Array(e);if(le(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function ii(e){if(le(e),e.length%xe!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${xe}`)}function ai(e,t,n){let r=e.length;const o=r%xe;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=W(e);if(t){let a=xe-o;a||(a=xe),r=r+a}const i=_r(r,n),c=W(i);return{b:s,o:c,out:i}}function ci(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const o=e.subarray(0,-r);for(let s=0;s<r;s++)if(e[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function li(e){const t=new Uint8Array(16),n=W(t);t.set(e);const r=xe-e.length;for(let o=xe-r;o<xe;o++)t[o]=r;return n}const Nr=Qs({blockSize:16,nonceLength:16},function(t,n,r={}){le(t),le(n,16);const o=!r.disablePadding;return{encrypt:(s,i)=>{const c=Cr(t),{b:a,o:u,out:f}=ai(s,o,i),l=W(n);let p=l[0],w=l[1],g=l[2],d=l[3],h=0;for(;h+4<=a.length;)p^=a[h+0],w^=a[h+1],g^=a[h+2],d^=a[h+3],{s0:p,s1:w,s2:g,s3:d}=jn(c,p,w,g,d),u[h++]=p,u[h++]=w,u[h++]=g,u[h++]=d;if(o){const y=li(s.subarray(h*4));p^=y[0],w^=y[1],g^=y[2],d^=y[3],{s0:p,s1:w,s2:g,s3:d}=jn(c,p,w,g,d),u[h++]=p,u[h++]=w,u[h++]=g,u[h++]=d}return c.fill(0),f},decrypt:(s,i)=>{ii(s);const c=oi(t),a=W(n),u=_r(s.length,i),f=W(s),l=W(u);let p=a[0],w=a[1],g=a[2],d=a[3];for(let h=0;h+4<=f.length;){const y=p,C=w,m=g,A=d;p=f[h+0],w=f[h+1],g=f[h+2],d=f[h+3];const{s0:_,s1:E,s2:x,s3:v}=si(c,p,w,g,d);l[h++]=_^y,l[h++]=E^C,l[h++]=x^m,l[h++]=v^A}return c.fill(0),ci(u,o)}}}),Br=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),ui=Br("expand 16-byte k"),fi=Br("expand 32-byte k"),di=W(ui),Ir=W(fi);Ir.slice();function H(e,t){return e<<t|e>>>32-t}function Zt(e){return e.byteOffset%4===0}const Qe=64,hi=16,kr=2**32-1,Fn=new Uint32Array;function pi(e,t,n,r,o,s,i,c){const a=o.length,u=new Uint8Array(Qe),f=W(u),l=Zt(o)&&Zt(s),p=l?W(o):Fn,w=l?W(s):Fn;for(let g=0;g<a;i++){if(e(t,n,r,f,i,c),i>=kr)throw new Error("arx: counter overflow");const d=Math.min(Qe,a-g);if(l&&d===Qe){const h=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let y=0,C;y<hi;y++)C=h+y,w[C]=p[C]^f[y];g+=Qe;continue}for(let h=0,y;h<d;h++)y=g+h,s[y]=o[y]^u[h];g+=d}}function gi(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=Ys({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return $t(o),$t(i),zn(s),zn(n),(c,a,u,f,l=0)=>{le(c),le(a),le(u);const p=u.length;if(f||(f=new Uint8Array(p)),le(f),$t(l),l<0||l>=kr)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);const w=[];let g=c.length,d,h;if(g===32)d=c.slice(),w.push(d),h=Ir;else if(g===16&&n)d=new Uint8Array(32),d.set(c),d.set(c,16),h=di,w.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Zt(a)||(a=a.slice(),w.push(a));const y=W(d);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(h,y,W(a.subarray(0,16)),y),a=a.subarray(16)}const C=16-o;if(C!==a.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const A=new Uint8Array(12);A.set(a,s?0:12-a.length),a=A,w.push(a)}const m=W(a);for(pi(e,h,y,m,u,f,l,i);w.length>0;)w.pop().fill(0);return f}}function yi(e,t,n,r,o,s=20){let i=e[0],c=e[1],a=e[2],u=e[3],f=t[0],l=t[1],p=t[2],w=t[3],g=t[4],d=t[5],h=t[6],y=t[7],C=o,m=n[0],A=n[1],_=n[2],E=i,x=c,v=a,L=u,I=f,B=l,U=p,R=w,D=g,b=d,S=h,N=y,T=C,k=m,P=A,M=_;for(let Q=0;Q<s;Q+=2)E=E+I|0,T=H(T^E,16),D=D+T|0,I=H(I^D,12),E=E+I|0,T=H(T^E,8),D=D+T|0,I=H(I^D,7),x=x+B|0,k=H(k^x,16),b=b+k|0,B=H(B^b,12),x=x+B|0,k=H(k^x,8),b=b+k|0,B=H(B^b,7),v=v+U|0,P=H(P^v,16),S=S+P|0,U=H(U^S,12),v=v+U|0,P=H(P^v,8),S=S+P|0,U=H(U^S,7),L=L+R|0,M=H(M^L,16),N=N+M|0,R=H(R^N,12),L=L+R|0,M=H(M^L,8),N=N+M|0,R=H(R^N,7),E=E+B|0,M=H(M^E,16),S=S+M|0,B=H(B^S,12),E=E+B|0,M=H(M^E,8),S=S+M|0,B=H(B^S,7),x=x+U|0,T=H(T^x,16),N=N+T|0,U=H(U^N,12),x=x+U|0,T=H(T^x,8),N=N+T|0,U=H(U^N,7),v=v+R|0,k=H(k^v,16),D=D+k|0,R=H(R^D,12),v=v+R|0,k=H(k^v,8),D=D+k|0,R=H(R^D,7),L=L+I|0,P=H(P^L,16),b=b+P|0,I=H(I^b,12),L=L+I|0,P=H(P^L,8),b=b+P|0,I=H(I^b,7);let O=0;r[O++]=i+E|0,r[O++]=c+x|0,r[O++]=a+v|0,r[O++]=u+L|0,r[O++]=f+I|0,r[O++]=l+B|0,r[O++]=p+U|0,r[O++]=w+R|0,r[O++]=g+D|0,r[O++]=d+b|0,r[O++]=h+S|0,r[O++]=y+N|0,r[O++]=C+T|0,r[O++]=m+k|0,r[O++]=A+P|0,r[O++]=_+M|0}const Tr=gi(yi,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Lr extends gr{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,se.hash(t);const r=Je(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return se.exists(this),this.iHash.update(t),this}digestInto(t){se.exists(this),se.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const yt=(e,t,n)=>new Lr(e,t).update(n).digest();yt.create=(e,t)=>new Lr(e,t);function wi(e,t,n){return se.hash(e),yt(e,Je(n),Je(t))}const Rt=new Uint8Array([0]),Kn=new Uint8Array;function mi(e,t,n,r=32){if(se.hash(e),se.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/e.outputLen);n===void 0&&(n=Kn);const s=new Uint8Array(o*e.outputLen),i=yt.create(e,t),c=i._cloneInto(),a=new Uint8Array(i.outputLen);for(let u=0;u<o;u++)Rt[0]=u+1,c.update(u===0?Kn:a).update(n).update(Rt).digestInto(a),s.set(a,e.outputLen*u),i._cloneInto(c);return i.destroy(),c.destroy(),a.fill(0),Rt.fill(0),s.slice(0,r)}var bi=Object.defineProperty,q=(e,t)=>{for(var n in t)bi(e,n,{get:t[n],enumerable:!0})},Pe=Symbol("verified"),Ei=e=>e instanceof Object;function cn(e){if(!Ei(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}var vi={};q(vi,{Queue:()=>Rr,QueueNode:()=>Ur,binarySearch:()=>ln,insertEventIntoAscendingList:()=>Ai,insertEventIntoDescendingList:()=>xi,normalizeURL:()=>$r,utf8Decoder:()=>ue,utf8Encoder:()=>ne});var ue=new TextDecoder("utf-8"),ne=new TextEncoder;function $r(e){e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function xi(e,t){const[n,r]=ln(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return r||e.splice(n,0,t),e}function Ai(e,t){const[n,r]=ln(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return r||e.splice(n,0,t),e}function ln(e,t){let n=0,r=e.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),s=t(e[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}var Ur=class{constructor(e){$(this,"value");$(this,"next",null);$(this,"prev",null);this.value=e}},Rr=class{constructor(){$(this,"first");$(this,"last");this.first=null,this.last=null}enqueue(e){const t=new Ur(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,e.value}},Si=class{generateSecretKey(){return We.utils.randomPrivateKey()}getPublicKey(e){return Z(We.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=Z(We.getPublicKey(t)),n.id=te(n),n.sig=Z(We.sign(te(n),t)),n[Pe]=!0,n}verifyEvent(e){if(typeof e[Pe]=="boolean")return e[Pe];const t=te(e);if(t!==e.id)return e[Pe]=!1,!1;try{const n=We.verify(e.sig,t,e.pubkey);return e[Pe]=n,n}catch{return e[Pe]=!1,!1}}};function Ci(e){if(!cn(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function te(e){let t=Fe(ne.encode(Ci(e)));return Z(t)}var wt=new Si,_i=wt.generateSecretKey,Pr=wt.getPublicKey,ae=wt.finalizeEvent,mt=wt.verifyEvent,Ni={};q(Ni,{Application:()=>Ia,BadgeAward:()=>Pi,BadgeDefinition:()=>xa,BlockedRelaysList:()=>ia,BookmarkList:()=>ra,Bookmarksets:()=>ba,Calendar:()=>Pa,CalendarEventRSVP:()=>Ha,ChannelCreation:()=>zr,ChannelHideMessage:()=>Kr,ChannelMessage:()=>Fr,ChannelMetadata:()=>jr,ChannelMuteUser:()=>Vr,ClassifiedListing:()=>La,ClientAuth:()=>Zr,CommunitiesList:()=>oa,CommunityDefinition:()=>Da,CommunityPostApproval:()=>Vi,Contacts:()=>$i,CreateOrUpdateProduct:()=>Ca,CreateOrUpdateStall:()=>Sa,Curationsets:()=>Ea,Date:()=>Ua,DirectMessageRelaysList:()=>ua,DraftClassifiedListing:()=>$a,DraftLong:()=>Na,Emojisets:()=>Ba,EncryptedDirectMessage:()=>Ui,EventDeletion:()=>Ri,FileMetadata:()=>Di,FileServerPreference:()=>fa,Followsets:()=>ya,GenericRepost:()=>Oi,Genericlists:()=>wa,GiftWrap:()=>Wr,HTTPAuth:()=>dn,Handlerinformation:()=>Ma,Handlerrecommendation:()=>Oa,Highlights:()=>Qi,InterestsList:()=>ca,Interestsets:()=>Aa,JobFeedback:()=>Gi,JobRequest:()=>Wi,JobResult:()=>Zi,Label:()=>Ki,LightningPubRPC:()=>ha,LiveChatMessage:()=>qi,LiveEvent:()=>ka,LongFormArticle:()=>_a,Metadata:()=>ki,Mutelist:()=>ea,NWCWalletInfo:()=>da,NWCWalletRequest:()=>Gr,NWCWalletResponse:()=>pa,NostrConnect:()=>ga,OpenTimestamps:()=>Mi,Pinlist:()=>ta,PrivateDirectMessage:()=>Hi,ProblemTracker:()=>zi,ProfileBadges:()=>va,PublicChatsList:()=>sa,Reaction:()=>fn,RecommendRelay:()=>Li,RelayList:()=>na,Relaysets:()=>ma,Report:()=>ji,Reporting:()=>Fi,Repost:()=>un,Seal:()=>qr,SearchRelaysList:()=>aa,ShortTextNote:()=>Ti,Time:()=>Ra,UserEmojiList:()=>la,UserStatuses:()=>Ta,Zap:()=>Xi,ZapGoal:()=>Ji,ZapRequest:()=>Yi,classifyKind:()=>Bi,isEphemeralKind:()=>Mr,isKind:()=>Ii,isParameterizedReplaceableKind:()=>Dr,isRegularKind:()=>Hr,isReplaceableKind:()=>Or});function Hr(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Or(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function Mr(e){return 2e4<=e&&e<3e4}function Dr(e){return 3e4<=e&&e<4e4}function Bi(e){return Hr(e)?"regular":Or(e)?"replaceable":Mr(e)?"ephemeral":Dr(e)?"parameterized":"unknown"}function Ii(e,t){const n=t instanceof Array?t:[t];return cn(e)&&n.includes(e.kind)||!1}var ki=0,Ti=1,Li=2,$i=3,Ui=4,Ri=5,un=6,fn=7,Pi=8,qr=13,Hi=14,Oi=16,zr=40,jr=41,Fr=42,Kr=43,Vr=44,Mi=1040,Wr=1059,Di=1063,qi=1311,zi=1971,ji=1984,Fi=1984,Ki=1985,Vi=4550,Wi=5999,Zi=6999,Gi=7e3,Ji=9041,Yi=9734,Xi=9735,Qi=9802,ea=1e4,ta=10001,na=10002,ra=10003,oa=10004,sa=10005,ia=10006,aa=10007,ca=10015,la=10030,ua=10050,fa=10096,da=13194,ha=21e3,Zr=22242,Gr=23194,pa=23195,ga=24133,dn=27235,ya=3e4,wa=30001,ma=30002,ba=30003,Ea=30004,va=30008,xa=30009,Aa=30015,Sa=30017,Ca=30018,_a=30023,Na=30024,Ba=30030,Ia=30078,ka=30311,Ta=30315,La=30402,$a=30403,Ua=31922,Ra=31923,Pa=31924,Ha=31925,Oa=31989,Ma=31990,Da=34550;function qa(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),o=e[`#${r}`];if(o&&!t.tags.find(([s,i])=>s===n.slice(1)&&o.indexOf(i)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function za(e,t){for(let n=0;n<e.length;n++)if(qa(e[n],t))return!0;return!1}var ja={};q(ja,{getHex64:()=>bt,getInt:()=>Jr,getSubscriptionId:()=>Yr,matchEventId:()=>Fa,matchEventKind:()=>Va,matchEventPubkey:()=>Ka});function bt(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function Jr(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,o=e.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function Yr(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return e.slice(r+1,s)}function Fa(e,t){return t===bt(e,"id")}function Ka(e,t){return t===bt(e,"pubkey")}function Va(e,t){return t===Jr(e,"kind")}var Wa={};q(Wa,{makeAuthEvent:()=>Xr});function Xr(e,t){return{kind:Zr,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function Za(){return new Promise(e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var Qr=class{constructor(e,t){$(this,"url");$(this,"_connected",!1);$(this,"onclose",null);$(this,"onnotice",e=>console.debug(`NOTICE from ${this.url}: ${e}`));$(this,"_onauth",null);$(this,"baseEoseTimeout",4400);$(this,"connectionTimeout",4400);$(this,"publishTimeout",4400);$(this,"openSubs",new Map);$(this,"connectionTimeoutHandle");$(this,"connectionPromise");$(this,"openCountRequests",new Map);$(this,"openEventPublishes",new Map);$(this,"ws");$(this,"incomingMessageQueue",new Rr);$(this,"queueRunning",!1);$(this,"challenge");$(this,"serial",0);$(this,"verifyEvent");$(this,"_WebSocket");this.url=$r(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const n=new Qr(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{var n;t("connection timed out"),this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=n=>{var r;t(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,(r=this.onclose)==null||r.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var n;this._connected&&(this._connected=!1,this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Za();this.queueRunning=!1}handleNext(){var n,r,o;const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=Yr(e);if(t){const s=this.openSubs.get(t);if(!s)return;const i=bt(e,"id"),c=(n=s.alreadyHaveEvent)==null?void 0:n.call(s,i);if((r=s.receivedEvent)==null||r.call(s,this,i),c)return}try{let s=JSON.parse(e);switch(s[0]){case"EVENT":{const i=this.openSubs.get(s[1]),c=s[2];this.verifyEvent(c)&&za(i.filters,c)&&i.onevent(c);return}case"COUNT":{const i=s[1],c=s[2],a=this.openCountRequests.get(i);a&&(a.resolve(c.count),this.openCountRequests.delete(i));return}case"EOSE":{const i=this.openSubs.get(s[1]);if(!i)return;i.receivedEose();return}case"OK":{const i=s[1],c=s[2],a=s[3],u=this.openEventPublishes.get(i);u&&(c?u.resolve(a):u.reject(new Error(a)),this.openEventPublishes.delete(i));return}case"CLOSED":{const i=s[1],c=this.openSubs.get(i);if(!c)return;c.closed=!0,c.close(s[2]);return}case"NOTICE":this.onnotice(s[1]);return;case"AUTH":{this.challenge=s[1],(o=this._onauth)==null||o.call(this,s[1]);return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{var t;(t=this.ws)==null||t.send(e)})}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(Xr(this.url,this.challenge)),n=new Promise((r,o)=>{this.openEventPublishes.set(t.id,{resolve:r,reject:o})});return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){const t=new Promise((n,r)=>{this.openEventPublishes.set(e.id,{resolve:n,reject:r})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),setTimeout(()=>{const n=this.openEventPublishes.get(e.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout),t}async count(e,t){this.serial++;const n=(t==null?void 0:t.id)||"count:"+this.serial,r=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new Ga(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,(e=this.ws)==null||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Ga=class{constructor(e,t,n,r){$(this,"relay");$(this,"id");$(this,"closed",!1);$(this,"eosed",!1);$(this,"filters");$(this,"alreadyHaveEvent");$(this,"receivedEvent");$(this,"onevent");$(this,"oneose");$(this,"onclose");$(this,"eoseTimeout");$(this,"eoseTimeoutHandle");this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,(e=this.oneose)==null||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),(t=this.onclose)==null||t.call(this,e)}},eo;try{eo=WebSocket}catch{}var Ce=class extends Qr{constructor(e){super(e,{verifyEvent:mt,websocketImplementation:eo})}static async connect(e){const t=new Ce(e);return await t.connect(),t}},Ja;try{Ja=WebSocket}catch{}var Ya={};q(Ya,{BECH32_REGEX:()=>to,Bech32MaxSize:()=>hn,NostrTypeGuard:()=>Xa,decode:()=>Et,encodeBytes:()=>xt,naddrEncode:()=>sc,neventEncode:()=>oc,noteEncode:()=>nc,nprofileEncode:()=>rc,npubEncode:()=>tc,nsecEncode:()=>ec});var Xa={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},hn=5e3,to=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Qa(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function Et(e){var o,s,i,c,a,u,f;let{prefix:t,words:n}=qe.decode(e,hn),r=new Uint8Array(qe.fromWords(n));switch(t){case"nprofile":{let l=Pt(r);if(!((o=l[0])!=null&&o[0]))throw new Error("missing TLV 0 for nprofile");if(l[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Z(l[0][0]),relays:l[1]?l[1].map(p=>ue.decode(p)):[]}}}case"nevent":{let l=Pt(r);if(!((s=l[0])!=null&&s[0]))throw new Error("missing TLV 0 for nevent");if(l[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(l[2]&&l[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(l[3]&&l[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Z(l[0][0]),relays:l[1]?l[1].map(p=>ue.decode(p)):[],author:(i=l[2])!=null&&i[0]?Z(l[2][0]):void 0,kind:(c=l[3])!=null&&c[0]?parseInt(Z(l[3][0]),16):void 0}}}case"naddr":{let l=Pt(r);if(!((a=l[0])!=null&&a[0]))throw new Error("missing TLV 0 for naddr");if(!((u=l[2])!=null&&u[0]))throw new Error("missing TLV 2 for naddr");if(l[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((f=l[3])!=null&&f[0]))throw new Error("missing TLV 3 for naddr");if(l[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:ue.decode(l[0][0]),pubkey:Z(l[2][0]),kind:parseInt(Z(l[3][0]),16),relays:l[1]?l[1].map(p=>ue.decode(p)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:Z(r)};default:throw new Error(`unknown prefix ${t}`)}}function Pt(e){let t={},n=e;for(;n.length>0;){let r=n[0],o=n[1],s=n.slice(2,2+o);if(n=n.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(s)}return t}function ec(e){return xt("nsec",e)}function tc(e){return xt("npub",De(e))}function nc(e){return xt("note",De(e))}function vt(e,t){let n=qe.toWords(t);return qe.encode(e,n,hn)}function xt(e,t){return vt(e,t)}function rc(e){let t=pn({0:[De(e.pubkey)],1:(e.relays||[]).map(n=>ne.encode(n))});return vt("nprofile",t)}function oc(e){let t;e.kind!==void 0&&(t=Qa(e.kind));let n=pn({0:[De(e.id)],1:(e.relays||[]).map(r=>ne.encode(r)),2:e.author?[De(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return vt("nevent",n)}function sc(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=pn({0:[ne.encode(e.identifier)],1:(e.relays||[]).map(r=>ne.encode(r)),2:[De(e.pubkey)],3:[new Uint8Array(t)]});return vt("naddr",n)}function pn(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(n)],0),s.set([o.length],1),s.set(o,2),t.push(s)})}),pt(...t)}var ic={};q(ic,{decrypt:()=>ac,encrypt:()=>no});async function no(e,t,n){const r=e instanceof Uint8Array?Z(e):e,o=je.getSharedSecret(r,"02"+t),s=ro(o);let i=Uint8Array.from(wr(16)),c=ne.encode(n),a=Nr(s,i).encrypt(c),u=fe.encode(new Uint8Array(a)),f=fe.encode(new Uint8Array(i.buffer));return`${u}?iv=${f}`}async function ac(e,t,n){const r=e instanceof Uint8Array?Z(e):e;let[o,s]=n.split("?iv="),i=je.getSharedSecret(r,"02"+t),c=ro(i),a=fe.decode(s),u=fe.decode(o),f=Nr(c,a).decrypt(u);return ue.decode(f)}function ro(e){return e.slice(1,33)}var cc={};q(cc,{NIP05_REGEX:()=>gn,isNip05:()=>lc,isValid:()=>dc,queryProfile:()=>oo,searchDomain:()=>fc,useFetchImplementation:()=>uc});var gn=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,lc=e=>gn.test(e||""),At;try{At=fetch}catch{}function uc(e){At=e}async function fc(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await At(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function oo(e){var o;const t=e.match(gn);if(!t)return null;const[,n="_",r]=t;try{const s=`https://${r}/.well-known/nostr.json?name=${n}`,i=await At(s,{redirect:"manual"});if(i.status!==200)throw Error("Wrong response code");const c=await i.json(),a=c.names[n];return a?{pubkey:a,relays:(o=c.relays)==null?void 0:o[a]}:null}catch{return null}}async function dc(e,t){const n=await oo(t);return n?n.pubkey===e:!1}var hc={};q(hc,{parse:()=>pc});function pc(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let o=e.tags.length-1;o>=0;o--){const s=e.tags[o];if(s[0]==="e"&&s[1]){const[i,c,a,u,f]=s,l={id:c,relays:a?[a]:[],author:f};if(u==="root"){t.root=l;continue}if(u==="reply"){t.reply=l;continue}if(u==="mention"){t.mentions.push(l);continue}n?r=l:n=l,t.mentions.push(l);continue}if(s[0]==="q"&&s[1]){const[i,c,a]=s;t.quotes.push({id:c,relays:a?[a]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let s=t.mentions.indexOf(o);if(s!==-1&&t.mentions.splice(s,1),o.author){let i=t.profiles.find(c=>c.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(c=>{var a;((a=o.relays)==null?void 0:a.indexOf(c))===-1&&o.relays.push(c)}),i.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let s=t.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),t}var gc={};q(gc,{fetchRelayInformation:()=>wc,useFetchImplementation:()=>yc});var so;try{so=fetch}catch{}function yc(e){so=e}async function wc(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var mc={};q(mc,{fastEventHash:()=>ao,getPow:()=>io,minePow:()=>bc});function io(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function bc(e,t){let n=0;const r=e,o=["nonce",n.toString(),t.toString()];for(r.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),o[1]=(++n).toString(),r.id=ao(r),io(r.id)>=t)break}return r}function ao(e){return Z(Fe(ne.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var Ec={};q(Ec,{finishRepostEvent:()=>vc,getRepostedEvent:()=>xc,getRepostedEventPointer:()=>co});function vc(e,t,n,r){return ae({kind:un,tags:[...e.tags??[],["e",t.id,n],["p",t.pubkey]],content:e.content===""?"":JSON.stringify(t),created_at:e.created_at},r)}function co(e){if(e.kind!==un)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(t!==void 0)return{id:t[1],relays:[t[2],n==null?void 0:n[2]].filter(r=>typeof r=="string"),author:n==null?void 0:n[1]}}function xc(e,{skipVerification:t}={}){const n=co(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!mt(r)))return r}var Ac={};q(Ac,{NOSTR_URI_REGEX:()=>St,parse:()=>Cc,test:()=>Sc});var St=new RegExp(`nostr:(${to.source})`);function Sc(e){return typeof e=="string"&&new RegExp(`^${St.source}$`).test(e)}function Cc(e){const t=e.match(new RegExp(`^${St.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:Et(t[1])}}var _c={};q(_c,{finishReactionEvent:()=>Nc,getReactedEventPointer:()=>Bc});function Nc(e,t,n){const r=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return ae({...e,kind:fn,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function Bc(e){if(e.kind!==fn)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Ic={};q(Ic,{matchAll:()=>kc,regex:()=>yn,replaceAll:()=>Tc});var yn=()=>new RegExp(`\\b${St.source}\\b`,"g");function*kc(e){const t=e.matchAll(yn());for(const n of t)try{const[r,o]=n;yield{uri:r,value:o,decoded:Et(o),start:n.index,end:n.index+r.length}}catch{}}function Tc(e,t){return e.replaceAll(yn(),(n,r)=>t({uri:n,value:r,decoded:Et(r)}))}var Lc={};q(Lc,{channelCreateEvent:()=>$c,channelHideMessageEvent:()=>Pc,channelMessageEvent:()=>Rc,channelMetadataEvent:()=>Uc,channelMuteUserEvent:()=>Hc});var $c=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return ae({kind:zr,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},Uc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return ae({kind:jr,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Rc=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),ae({kind:Fr,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},Pc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return ae({kind:Kr,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Hc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return ae({kind:Vr,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},Oc={};q(Oc,{EMOJI_SHORTCODE_REGEX:()=>lo,matchAll:()=>Mc,regex:()=>wn,replaceAll:()=>Dc});var lo=/:(\w+):/,wn=()=>new RegExp(`\\B${lo.source}\\B`,"g");function*Mc(e){const t=e.matchAll(wn());for(const n of t)try{const[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function Dc(e,t){return e.replaceAll(wn(),(n,r)=>t({shortcode:n,name:r}))}var qc={};q(qc,{useFetchImplementation:()=>zc,validateGithub:()=>jc});var mn;try{mn=fetch}catch{}function zc(e){mn=e}async function jc(e,t,n){try{return await(await mn(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var Fc={};q(Fc,{decrypt:()=>xn,encrypt:()=>vn,getConversationKey:()=>bn,v2:()=>Gc});var uo=1,fo=65535;function bn(e,t){const n=je.getSharedSecret(e,"02"+t).subarray(1,33);return wi(Fe,n,"nip44-v2")}function ho(e,t){const n=mi(Fe,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function En(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function Kc(e){if(!Number.isSafeInteger(e)||e<uo||e>fo)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function Vc(e){const t=ne.encode(e),n=t.length,r=Kc(n),o=new Uint8Array(En(n)-n);return pt(r,t,o)}function Wc(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<uo||t>fo||n.length!==t||e.length!==2+En(t))throw new Error("invalid padding");return ue.decode(n)}function po(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=pt(n,t);return yt(Fe,e,r)}function Zc(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=fe.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function vn(e,t,n=wr(32)){const{chacha_key:r,chacha_nonce:o,hmac_key:s}=ho(t,n),i=Vc(e),c=Tr(r,o,i),a=po(s,c,n);return fe.encode(pt(new Uint8Array([2]),n,c,a))}function xn(e,t){const{nonce:n,ciphertext:r,mac:o}=Zc(e),{chacha_key:s,chacha_nonce:i,hmac_key:c}=ho(t,n),a=po(c,r,n);if(!Xs(a,o))throw new Error("invalid MAC");const u=Tr(s,i,r);return Wc(u)}var Gc={utils:{getConversationKey:bn,calcPaddedLen:En},encrypt:vn,decrypt:xn},Jc={};q(Jc,{makeNwcRequestEvent:()=>Xc,parseConnectionString:()=>Yc});function Yc(e){const{pathname:t,searchParams:n}=new URL(e),r=t,o=n.get("relay"),s=n.get("secret");if(!r||!o||!s)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:s}}async function Xc(e,t,n){const o=await no(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:Gr,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return ae(s,t)}var Qc={};q(Qc,{getZapEndpoint:()=>tl,makeZapReceipt:()=>ol,makeZapRequest:()=>nl,useFetchImplementation:()=>el,validateZapRequest:()=>rl});var An;try{An=fetch}catch{}function el(e){An=e}async function tl(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:i}=qe.decode(n,1e3),c=qe.fromWords(i);t=ue.decode(c)}else if(r){let[i,c]=r.split("@");t=new URL(`/.well-known/lnurlp/${i}`,`https://${c}`).toString()}else return null;let s=await(await An(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function nl({profile:e,event:t,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e],["amount",n.toString()],["relays",...r]]};return t&&s.tags.push(["e",t]),s}function rl(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!cn(t))return"Zap request is not a valid Nostr event.";if(!mt(t))return"Invalid signature on zap request.";let n=t.tags.find(([s,i])=>s==="p"&&i);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([s,i])=>s==="e"&&i);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function ol({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let o=JSON.parse(e),s=o.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",e]]};return t&&i.tags.push(["preimage",t]),i}var sl={};q(sl,{createRumor:()=>bo,createSeal:()=>Eo,createWrap:()=>vo,unwrapEvent:()=>xo,unwrapManyEvents:()=>cl,wrapEvent:()=>Gt,wrapManyEvents:()=>al});var il=2*24*60*60,go=()=>Math.round(Date.now()/1e3),yo=()=>Math.round(go()-Math.random()*il),wo=(e,t)=>bn(e,t),mo=(e,t,n)=>vn(JSON.stringify(e),wo(t,n)),Vn=(e,t)=>JSON.parse(xn(e.content,wo(t,e.pubkey)));function bo(e,t){const n={created_at:go(),content:"",tags:[],...e,pubkey:Pr(t)};return n.id=te(n),n}function Eo(e,t,n){return ae({kind:qr,content:mo(e,t,n),created_at:yo(),tags:[]},t)}function vo(e,t){const n=_i();return ae({kind:Wr,content:mo(e,n,t),created_at:yo(),tags:[["p",t]]},n)}function Gt(e,t,n){const r=bo(e,t),o=Eo(r,t,n);return vo(o,n)}function al(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Pr(t),o=[Gt(e,t,r)];return n.forEach(s=>{o.push(Gt(e,t,s))}),o}function xo(e,t){const n=Vn(e,t);return Vn(n,t)}function cl(e,t){let n=[];return e.forEach(r=>{n.push(xo(r,t))}),n.sort((r,o)=>r.created_at-o.created_at),n}var ll={};q(ll,{getToken:()=>ul,hashPayload:()=>Sn,unpackEventFromToken:()=>So,validateEvent:()=>ko,validateEventKind:()=>_o,validateEventMethodTag:()=>Bo,validateEventPayloadTag:()=>Io,validateEventTimestamp:()=>Co,validateEventUrlTag:()=>No,validateToken:()=>fl});var Ao="Nostr ";async function ul(e,t,n,r=!1,o){const s={kind:dn,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",Sn(o)]);const i=await n(s);return(r?Ao:"")+fe.encode(ne.encode(JSON.stringify(i)))}async function fl(e,t,n){const r=await So(e).catch(s=>{throw s});return await ko(r,t,n).catch(s=>{throw s})}async function So(e){if(!e)throw new Error("Missing token");e=e.replace(Ao,"");const t=ue.decode(fe.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function Co(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function _o(e){return e.kind===dn}function No(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function Bo(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function Sn(e){const t=Fe(ne.encode(JSON.stringify(e)));return Z(t)}function Io(e,t){const n=e.tags.find(o=>o[0]==="payload");if(!n)return!1;const r=Sn(t);return n.length>0&&n[1]===r}async function ko(e,t,n,r){if(!mt(e))throw new Error("Invalid nostr event, signature invalid");if(!_o(e))throw new Error("Invalid nostr event, kind invalid");if(!Co(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!No(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!Bo(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!Io(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var Ne={},Wn;function dl(){if(Wn)return Ne;Wn=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.bech32m=Ne.bech32=void 0;const e="qpzry9x8gf2tvdw0s3jn54khce6mua7l",t={};for(let u=0;u<e.length;u++){const f=e.charAt(u);t[f]=u}function n(u){const f=u>>25;return(u&33554431)<<5^-(f>>0&1)&996825010^-(f>>1&1)&642813549^-(f>>2&1)&513874426^-(f>>3&1)&1027748829^-(f>>4&1)&705979059}function r(u){let f=1;for(let l=0;l<u.length;++l){const p=u.charCodeAt(l);if(p<33||p>126)return"Invalid prefix ("+u+")";f=n(f)^p>>5}f=n(f);for(let l=0;l<u.length;++l){const p=u.charCodeAt(l);f=n(f)^p&31}return f}function o(u,f,l,p){let w=0,g=0;const d=(1<<l)-1,h=[];for(let y=0;y<u.length;++y)for(w=w<<f|u[y],g+=f;g>=l;)g-=l,h.push(w>>g&d);if(p)g>0&&h.push(w<<l-g&d);else{if(g>=f)return"Excess padding";if(w<<l-g&d)return"Non-zero padding"}return h}function s(u){return o(u,8,5,!0)}function i(u){const f=o(u,5,8,!1);if(Array.isArray(f))return f}function c(u){const f=o(u,5,8,!1);if(Array.isArray(f))return f;throw new Error(f)}function a(u){let f;u==="bech32"?f=1:f=734539939;function l(d,h,y){if(y=y||90,d.length+7+h.length>y)throw new TypeError("Exceeds length limit");d=d.toLowerCase();let C=r(d);if(typeof C=="string")throw new Error(C);let m=d+"1";for(let A=0;A<h.length;++A){const _=h[A];if(_>>5)throw new Error("Non 5-bit word");C=n(C)^_,m+=e.charAt(_)}for(let A=0;A<6;++A)C=n(C);C^=f;for(let A=0;A<6;++A){const _=C>>(5-A)*5&31;m+=e.charAt(_)}return m}function p(d,h){if(h=h||90,d.length<8)return d+" too short";if(d.length>h)return"Exceeds length limit";const y=d.toLowerCase(),C=d.toUpperCase();if(d!==y&&d!==C)return"Mixed-case string "+d;d=y;const m=d.lastIndexOf("1");if(m===-1)return"No separator character for "+d;if(m===0)return"Missing prefix for "+d;const A=d.slice(0,m),_=d.slice(m+1);if(_.length<6)return"Data too short";let E=r(A);if(typeof E=="string")return E;const x=[];for(let v=0;v<_.length;++v){const L=_.charAt(v),I=t[L];if(I===void 0)return"Unknown character "+L;E=n(E)^I,!(v+6>=_.length)&&x.push(I)}return E!==f?"Invalid checksum for "+d:{prefix:A,words:x}}function w(d,h){const y=p(d,h);if(typeof y=="object")return y}function g(d,h){const y=p(d,h);if(typeof y=="object")return y;throw new Error(y)}return{decodeUnsafe:w,decode:g,encode:l,toWords:s,fromWordsUnsafe:i,fromWords:c}}return Ne.bech32=a("bech32"),Ne.bech32m=a("bech32m"),Ne}var hl=dl();let J,et,tt,nt;const Te="wss://nostrrelay.taylorperron.com",pl="https://nostrcheck.taylorperron.com/upload",To="5a3b311740b43beda985361f55556e9eb5b39f7221d76791967bc777b3d21323",Lo="21";document.getElementById("notes");const gl=document.getElementById("note-form"),Zn=document.getElementById("note-content"),Gn=document.getElementById("photo-upload");async function yl(e){new FormData().append("file",e,e.name);try{const n=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-256",n),o=Array.from(new Uint8Array(r)).map(p=>p.toString(16).padStart(2,"0")).join("");if(!window.nostr)throw new Error("NIP-07 signing extension not found.");const s=await window.nostr.getPublicKey(),i=Math.floor(Date.now()/1e3)+300,c={kind:24242,created_at:Math.floor(Date.now()/1e3),tags:[["t","upload"],["x",o],["expiration",i.toString()]],content:"Upload authorization for Blossom",pubkey:s};c.id=te(c);const a=await window.nostr.signEvent(c);if(a.sig)c.sig=a.sig;else throw new Error("Signature missing from signed event");const u=btoa(JSON.stringify(c)),f=await fetch(pl,{method:"PUT",headers:{Authorization:`Nostr ${u}`},body:e});if(!f.ok)throw new Error(`Photo upload failed: ${f.statusText}`);return(await f.json()).url}catch(n){throw console.error("Error uploading photo:",n),n}}async function wl(){const e=Zn.value.trim();if(!e){alert("Note content cannot be empty!");return}const t=Gn.files[0];let n=null;if(t)try{n=await yl(t)}catch{alert("Failed to upload photo. See console for details.");return}async function r(a){const u=await a.arrayBuffer(),f=await crypto.subtle.digest("SHA-256",u);return Array.from(new Uint8Array(f)).map(l=>l.toString(16).padStart(2,"0")).join("")}function o(a){const{data:u}=hl.decode(a.replace("npub",""));return Buffer.from(u).toString("hex")}async function s(a){const[u,f]=a.split("@"),l=`https://${f}/.well-known/nostr.json?name=${u}`;return(await(await fetch(l)).json()).names[u]}async function i(a){const u=/\bnpub1[0-9a-z]{59}\b/g,f=/\b[\w.-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\b/g,l=[...a.matchAll(u)],p=[...a.matchAll(f)],w=[];for(const g of l)try{const d=o(g[0]);w.push(["p",d])}catch(d){console.error(`Failed to process npub: ${g[0]}`,d)}for(const g of p)try{const d=await s(g[0]);w.push(["p",d])}catch(d){console.error(`Failed to resolve NIP-05 identifier: ${g[0]}`,d)}return w}function c(a){const u=/#(\w+)/g;return[...a.matchAll(u)].map(l=>l[1])}try{if(!window.nostr)throw new Error("NIP-07 signing extension not found.");const a=await window.nostr.getPublicKey(),u=t.type,f=await r(t),p=c(e).map(y=>["t",y]),w=await i(e),g={kind:20,created_at:Math.floor(Date.now()/1e3),tags:[["imeta",`url ${n}`,`m ${u}`,"alt Kind 20 photo posted from PIPPIN",`x ${f}`],...w,["m",u],["x",f],...p,["L","ISO-639-1"],["l","en","ISO-639-1"],["client","PIPPIN","31990:fe2fb6daf39a23cb1a650d2aa052a22f8ed042893f8aa1c1d625012f07578834","wss://nostrrelay.taylorperron.com"]],content:e,pubkey:a};g.id=te(g);const d=await window.nostr.signEvent(g);if(!d.sig)throw new Error("Signing failed, no signature returned");g.sig=d.sig;const h=new Ce(Te);await h.connect(),h.publish(g),Zn.value="",Gn.value=null,alert("Kind 20 note published successfully!")}catch(a){console.error("Error publishing Kind 20 note:",a),alert("Failed to publish Kind 20 note. See console for details.")}}gl.addEventListener("submit",e=>{e.preventDefault(),wl()});async function ml(){let e=null;if(window.nostr)try{e=await window.nostr.getPublicKey(),console.log("User is signed in with pubkey:",e)}catch(t){console.error("Failed to retrieve user public key:",t)}e?(console.log("User signed in. Displaying user's feed."),El()):(console.log("No user signed in. Displaying notes for the default account."),bl())}async function bl(){console.log("Fetching notes for the default account..."),console.log("Relay connected for default account.");const e=[{kinds:[20],authors:[To],until:ze-1,limit:10}],t=[];J.subscribe(e,{onevent:n=>{t.some(r=>r.id===n.id)?console.log("Duplicate note skipped in tempNotes:",n.id):t.push(n)},oneose:async()=>{t.length>0?(V=Array.from(new Map([...V,...t].map(n=>[n.id,n])).values()),V.forEach(n=>{n.created_at=parseInt(n.created_at,10)}),V.sort((n,r)=>r.created_at-n.created_at),t.sort((n,r)=>r.created_at-n.created_at),ze=t[0].created_at,await Promise.all(t.map(n=>Cn(n))),Ye(),_n()):(console.log("No new notes fetched for default account."),Ye()),console.log("Finished fetching and rendering default account notes.")}})}async function El(){console.log("Fetching user-specific feed...");const e=[{kinds:[20],authors:[To],until:ze-1,limit:10}];console.log("Filters for user feed:",e);const t=[];J.subscribe(e,{onevent:n=>{t.some(r=>r.id===n.id)?console.log("Duplicate note skipped in tempNotes:",n.id):t.push(n)},oneose:async()=>{t.length>0?(V=Array.from(new Map([...V,...t].map(n=>[n.id,n])).values()),V.forEach(n=>{n.created_at=parseInt(n.created_at,10)}),V.sort((n,r)=>r.created_at-n.created_at),t.sort((n,r)=>r.created_at-n.created_at),ze=t[0].created_at,await Promise.all(t.map(n=>Cn(n))),Ye(),_n()):(console.log("No new notes fetched for user feed."),Ye()),console.log("Finished fetching and rendering user feed notes.")}})}let ze=Math.floor(Date.now()/1e3),V=[],ot=!1;async function vl(e,t=10){if(ot)return;ot=!0;const n=[{kinds:[20],until:ze-1,limit:t}],r=[],o=J.subscribe(n,{});o.onevent=s=>{r.some(i=>i.id===s.id)||r.push(s)},o.oneose=async()=>{r.length>0&&(V=Array.from(new Map([...V,...r].map(s=>[s.id,s])).values()),V.forEach(s=>console.log(s.created_at,typeof s.created_at)),V.forEach(s=>{s.created_at=parseInt(s.created_at,10)}),V.sort((s,i)=>i.created_at-s.created_at),r.sort((s,i)=>i.created_at-s.created_at),ze=r[0].created_at,await Promise.all(r.map(s=>Cn(s))),Ye(),_n()),o.close()},ot=!1}function xl(){window.addEventListener("scroll",async()=>{const e=window.scrollY+window.innerHeight,t=document.documentElement.scrollHeight;e>=t-100&&(ot||await vl())})}function Cn(e){e.created_at=parseInt(e.created_at,10);const t=document.getElementById("notes"),n=document.createElement("div");n.className="note",n.dataset.createdAt=e.created_at,n.dataset.noteId=e.id;const r=document.createElement("div");r.className="note-header",r.textContent=new Date(e.created_at*1e3).toLocaleString(),n.appendChild(r);const o=document.createElement("p");o.textContent=e.content,n.appendChild(o);const i=e.tags.filter(m=>m[0]==="imeta").map(m=>{const A=m.find(_=>_.startsWith("url "));return A?A.replace("url ",""):null}).filter(m=>m!==null);if(i.length>0){let m=0;const A=document.createElement("div");A.className="image-carousel";const _=document.createElement("img");if(_.src=i[m],_.alt="Note image",_.className="note-image",A.appendChild(_),i.length>1){const x=document.createElement("button");x.textContent="",x.className="carousel-button left-button",x.onclick=()=>{m=(m-1+i.length)%i.length,_.src=i[m]};const v=document.createElement("button");v.textContent="",v.className="carousel-button right-button",v.onclick=()=>{m=(m+1)%i.length,_.src=i[m]},A.appendChild(x),A.appendChild(v)}let E=0;A.addEventListener("touchstart",x=>{E=x.touches[0].clientX}),A.addEventListener("touchend",x=>{const v=x.changedTouches[0].clientX;E-v>50?m=(m+1)%i.length:v-E>50&&(m=(m-1+i.length)%i.length),_.src=i[m]}),n.appendChild(A)}const c=document.createElement("div");c.className="note-actions";const a=document.createElement("button");a.innerHTML="",a.className="like-button";const u=document.createElement("span");u.className="reaction-count",u.textContent="0",a.appendChild(u),c.appendChild(a),t.appendChild(n),_l(e,n);const f=document.createElement("button");f.innerHTML="",f.className="repost-button";const l=document.createElement("span");l.className="repost-count",l.textContent="0",f.appendChild(l),c.appendChild(f),f.onclick=async()=>{try{await Il(e.id),f.classList.add("reposted"),l.textContent=parseInt(l.textContent)+1}catch(m){console.error("Error reposting note:",m),alert("Failed to repost. See console for details.")}};const p=document.createElement("button");p.innerHTML="",p.className="comment-button";const w=document.createElement("span");w.className="comment-count",w.setAttribute("data-note-id",e.id),w.textContent="0",p.appendChild(w),c.appendChild(p),p.onclick=()=>{g(e.id)};async function g(m){const A=document.createElement("div");A.className="comment-popup";const _=document.createElement("div");_.className="popup-content";const E=document.createElement("button");E.textContent="",E.className="close-button",E.onclick=()=>A.remove();const x=document.createElement("div");x.className="comments-section";const v=document.createElement("form");v.className="comment-form";const L=document.createElement("textarea");L.placeholder="Write a comment...",L.required=!0;const I=document.createElement("button");I.textContent="Post Comment",I.type="submit",v.appendChild(L),v.appendChild(I),v.onsubmit=async U=>{U.preventDefault();const R=L.value.trim();R&&(await Tl(m,R),L.value="",kl(m,x))},_.appendChild(E),_.appendChild(x),_.appendChild(v),A.appendChild(_),document.body.appendChild(A);const B=J.subscribe([{kinds:[1],"#e":[m]}],{});B.on("event",async U=>{if(!document.getElementById(`comment-${U.id}`)){const R=await $o(U.pubkey);Nl(U,R,x)}}),B.on("eose",()=>{B.close()})}const d=document.createElement("button");d.innerHTML="",d.className="zap-button";const h=document.createElement("span");h.className="zap-count",h.textContent="0",d.appendChild(h),c.appendChild(d);async function y(m){const A=J.subscribe([{kinds:[0],authors:[m]}],{});return new Promise((_,E)=>{A.on("event",x=>{const v=JSON.parse(x.content),L=v.lud16||atob(v.lud06||"");L?_(L):E("No Lightning Address found in profile."),A.close()}),A.on("eose",()=>{E("Profile not found or incomplete."),A.close()})})}d.onclick=async()=>{const m=m;try{const A=await window.nostr.getPublicKey(),_=await y(e.pubkey),E=`https://${_.split("@")[1]}/.well-known/lnurlp/${_.split("@")[0]}`;console.log("LNURL for zapping:",E);const v=await(await fetch(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:m*1e3,nostr:JSON.stringify({kind:9735,created_at:Math.floor(Date.now()/1e3),tags:[["e",e.id],["p",e.pubkey],["amount",m.toString()],["lnurl",_]],content:"Zap via Pippin",pubkey:A})})})).json();if(!v.pr)throw new Error("No payment request (invoice) returned from LNURL.");alert(`Zap Invoice:

${v.pr}

Copy this invoice to your Lightning wallet to complete the zap.`),console.log("Zap Invoice:",v.pr)}catch(A){console.error("Error zapping note via NWC:",A),alert("Failed to zap note. See console for details.")}},n.appendChild(c);const C=J.subscribe([{kinds:[6],"#e":[e.id]}],{onEvent:m=>{l.textContent=parseInt(l.textContent)+1},onEose:()=>{C.unsubscribe()}})}function Al(){const e=V.map(n=>n.id);et&&typeof et.unsubscribe=="function"&&et.unsubscribe();const t=[{kinds:[7],"#e":e}];et=J.subscribe(t,{onEvent:n=>{const r=n.tags.find(i=>i[0]==="e");if(!r)return;const o=r[1],s=document.querySelector(`.note[data-note-id="${o}"]`);if(s){const i=s.querySelector(".reaction-count");i&&(i.textContent=parseInt(i.textContent)+1)}},onEose:()=>{console.log("globalReactionSub received eose")}})}function Sl(){const e=V.map(n=>n.id);tt&&typeof tt.unsubscribe=="function"&&tt.unsubscribe();const t=[{kinds:[6],"#e":e}];tt=J.subscribe(t,{onEvent:n=>{const r=n.tags.find(i=>i[0]==="e");if(!r)return;const o=r[1],s=document.querySelector(`.note[data-note-id="${o}"]`);if(s){const i=s.querySelector(".repost-count");i&&(i.textContent=parseInt(i.textContent)+1)}},onEose:()=>{console.log("globalRepostSub received eose")}})}function Cl(){const e=V.map(n=>n.id);nt&&typeof nt.unsubscribe=="function"&&nt.unsubscribe();const t=[{kinds:[9735],"#e":e}];nt=J.subscribe(t,{onEvent:n=>{const r=n.tags.find(i=>i[0]==="e");if(!r)return;const o=r[1],s=document.querySelector(`.note[data-note-id="${o}"]`);if(s){const i=s.querySelector(".zap-count");i&&(i.textContent=parseInt(i.textContent)+1)}},onEose:()=>{console.log("globalZapSub received eose")}})}function _n(){Al(),Sl(),Cl()}async function _l(e,t){const n=e.pubkey;try{const r=await $o(n),{picture:o,displayName:s,nip05:i}=r,c=t.querySelector(".note-header");c.innerHTML="";const a=document.createElement("img");a.src=o||"default-profile.png",a.alt=`${s||n}'s profile picture`,a.className="profile-pic";const u=document.createElement("div");u.className="name-container";const f=document.createElement("span");f.textContent=s||n,f.className="display-name";const l=document.createElement("span");l.textContent=i?`@${i}`:"",l.className="nip05-status",i&&(l.style.color="green"),u.appendChild(f),u.appendChild(l);const p=document.createElement("div");p.className="profile-container",p.appendChild(a),p.appendChild(u);const w=document.createElement("div");w.className="timestamp";const g=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).format(new Date(e.created_at*1e3));w.textContent=g,c.appendChild(p),c.appendChild(w)}catch(r){console.error("Error updating note details:",r)}}function Ye(){const e=document.getElementById("notes"),t=Array.from(e.children);t.sort((n,r)=>parseInt(r.dataset.createdAt,10)-parseInt(n.dataset.createdAt,10)),e.innerHTML="",t.forEach(n=>e.appendChild(n))}function Nl(e,t,n){const r=document.createElement("div");r.className="comment";const o=document.createElement("img");o.src=t.picture||"default-profile.png",o.alt=`${t.displayName||e.pubkey}'s profile picture`,o.className="comment-profile-pic";const s=document.createElement("span");s.textContent=t.displayName||e.pubkey,s.className="comment-display-name";const i=document.createElement("p");i.textContent=e.content,i.className="comment-content";const c=document.createElement("div");c.className="comment-buttons";const a=document.createElement("button");a.innerHTML="",a.className="comment-like-button";const u=document.createElement("span");u.className="like-count",u.textContent="0",a.appendChild(u),a.onclick=async()=>{await $l(e.id),u.textContent=parseInt(u.textContent)+1};const f=document.createElement("button");f.innerHTML="",f.className="comment-reply-button";const l=document.createElement("span");l.className="comment-count",l.textContent="0",f.appendChild(l),f.onclick=()=>openCommentPopup(e.id);const p=document.createElement("button");p.innerHTML="",p.className="comment-zap-button";const w=document.createElement("span");w.className="zap-count",w.textContent="0",p.appendChild(w),p.onclick=async()=>{await Ul(e.id),w.textContent=parseInt(w.textContent)+Lo},c.appendChild(a),c.appendChild(f),c.appendChild(p),r.appendChild(o),r.appendChild(s),r.appendChild(i),r.appendChild(c),n.appendChild(r)}const rt=new Map;async function $o(e){return rt.has(e)?rt.get(e):new Promise((t,n)=>{J.subscribe([{kinds:[0],authors:[e]}],{onevent:r=>{try{const o=JSON.parse(r.content),s={picture:o.picture||null,displayName:o.display_name||o.name||e,nip05:o.nip05||null};rt.set(e,s),t(s)}catch(o){n(o)}},oneose:()=>{const r={picture:null,displayName:e,nip05:null};rt.set(e,r),t(r)},onerror:r=>{console.error("Profile subscription failed:",r),n(r)}})})}async function Bl(e){if(!window.nostr){alert("NIP-07 signing extension not found!");return}try{const t=await window.nostr.getPublicKey(),n={kind:7,created_at:Math.floor(Date.now()/1e3),tags:[["e",e],["p",t]],content:"",pubkey:t};n.id=te(n),n.sig=await window.nostr.signEvent(n);const r=new Ce(Te);await r.connect();const o=r.publish(n);o.on("ok",()=>{}),o.on("failed",s=>{console.error("Failed to publish reaction event:",s)})}catch(t){console.error("Error reacting to note:",t)}}async function Il(e){if(!window.nostr){alert("NIP-07 signing extension not found!");return}try{const t=await window.nostr.getPublicKey(),n={kind:6,created_at:Math.floor(Date.now()/1e3),tags:[["e",e],["p",t]],content:"",pubkey:t};n.id=te(n),n.sig=await window.nostr.signEvent(n);const r=new Ce(Te);await r.connect();const o=r.publish(n);o.on("ok",()=>{console.log("Repost event published successfully")}),o.on("failed",s=>{console.error("Failed to publish repost event:",s)})}catch(t){console.error("Error reposting note:",t)}}async function kl(e,t){t.innerHTML="<p>Loading comments...</p>",console.log("Note ID for comment subscription:",e);const n=J.subscribe([{kinds:[1],"#e":[e]}],{});console.log("Subscription created:",n),t.innerHTML="",n.on("event",r=>{var i;if(r.kind===1){const c=r.tags.find(a=>a[0]==="e")[1];updateCommentCount(c,parseInt(((i=document.querySelector(`.comment-count[data-note-id="${c}"]`))==null?void 0:i.textContent)||0)+1)}typeof n.unsubscribe=="function"&&n.unsubscribe();const o=document.createElement("div");o.className="comment";const s=document.createElement("p");s.textContent=r.content,o.appendChild(s),Ll(o,r),t.appendChild(o)}),n.on("eose",()=>{setTimeout(()=>{commentSection.children.length===0&&(commentSection.innerHTML="<p>No comments found.</p>")},3e3)}),typeof n.unsubscribe=="function"&&n.unsubscribe(),n.on("failed",r=>{console.error("Subscription failed:",r),reject(r)})}async function Tl(e,t){if(!window.nostr){alert("NIP-07 signing extension not found!");return}try{const n=await window.nostr.getPublicKey(),r={kind:1,created_at:Math.floor(Date.now()/1e3),tags:[["e",e]],content:t,pubkey:n};r.id=te(r);const o=await window.nostr.signEvent(r);r.sig=o.sig;const s=new Ce(Te);await s.connect(),s.publish(r).then(()=>{console.log("Comment published successfully.")}).catch(i=>{console.error("Failed to publish comment:",i)})}catch(n){console.error("Error posting comment:",n),alert("Failed to post comment. See console for details.")}}function Ll(e,t){const n=document.createElement("button");n.innerHTML="",n.onclick=async()=>{await Bl(t.id)};const r=document.createElement("button");r.innerHTML="",r.onclick=()=>openCommentPopup(t.id);const o=document.createElement("button");o.innerHTML="",o.onclick=async()=>{await zapNote(t.id)},e.appendChild(n),e.appendChild(r),e.appendChild(o)}async function $l(e){if(!window.nostr){alert("NIP-07 signing extension not found!");return}try{const t=await window.nostr.getPublicKey(),n={kind:7,created_at:Math.floor(Date.now()/1e3),tags:[["e",e],["p",t]],content:"",pubkey:t};n.id=te(n),n.sig=await window.nostr.signEvent(n);const r=new Ce(Te);await r.connect(),r.publish(n),console.log("Reaction event published:",n)}catch(t){console.error("Error reacting to comment:",t)}}async function Ul(e){if(!window.nostr){alert("NIP-07 signing extension not found!");return}try{const t=await window.nostr.getPublicKey(),n={kind:9735,created_at:Math.floor(Date.now()/1e3),tags:[["e",e],["p",t]],content:`${Lo} sats zap`,pubkey:t};n.id=te(n),n.sig=await window.nostr.signEvent(n);const r=new Ce(Te);await r.connect(),r.publish(n),console.log("Zap event published:",n)}catch(t){console.error("Error zapping comment:",t)}}document.addEventListener("DOMContentLoaded",async()=>{console.log("Page loaded. Initializing client..."),J=new Ce(Te);try{await J.connect(),console.log("Global relay connected successfully.")}catch(e){console.error("Failed to connect global relay:",e)}await ml(),xl()});
